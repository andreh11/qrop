language: cpp

matrix:
  include:
    - os: linux
      env:
        - QROP_PLATFORM="linux"
      compiler: g++
      dist: trusty
      sudo: required
      deploy:
        provider: releases
        api_key: $GH_TOKEN
        file: ${TRAVIS_BUILD_DIR}/build/deploy/Qrop-x86_64.AppImage
        skip_cleanup: true
        draft: false
        on:
          tags: true
      addons:
        apt:
          sources:
            # - sourceline: 'ppa:beineri/opt-qt-5.12.0-xenial'
            - sourceline: 'ppa:beineri/opt-qt-5.10.1-trusty'
              key_url: 'https://keyserver.ubuntu.com/pks/lookup?op=get&search=0x10C56D0DE9977759'
          packages:
            - build-essential
            - libfontconfig1
            - mesa-common-dev
            - libglu1-mesa-dev
            - libsqlite3-dev
            - libxcb-xinerama0
            - qt510-meta-minimal
            - qt510base
            - qt510charts-no-lgpl
            - qt510connectivity
            - qt510declarative
            - qt510graphicaleffects
            - qt510imageformats
            - qt510quickcontrols
            - qt510quickcontrols2
            - qt510tools
            - qt510translations
            # - qt510wayland
            - qt510x11extras
    - os: osx
      env:
        - QROP_PLATFORM="osx"
        - PATH="/usr/local/opt/qt/bin:$PATH"
        - LDFLAGS="-L/usr/local/opt/qt/lib"
        - CPPFLAGS="-I/usr/local/opt/qt/include"
        - PKG_CONFIG_PATH="/usr/local/opt/qt/lib/pkgconfig"
      osx_image: xcode10.1
      compiler: clang
      addons:
        homebrew:
          packages:
            - qt
            - tree
          update: true
    # - os: windows
    #   env: QROP_PLATFORM="linux"
    #   compiler: msvc2015

install:
  - if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then source /opt/qt510/bin/qt510-env.sh; fi

script:
  - sh ${TRAVIS_BUILD_DIR}/dist/${QROP_PLATFORM}/build.sh

env:
  global:
    secure: a2sSFPhaFFjFPaJz9kWr1WCJGP1H4301Dhd8TzGR4ZxfqGpFjMn1k+92eVO3QKc9zVmSgHx95hIsSARMOs1yDaKthASSkkLBsrY9Uep6zGX9AXA8+N+pSMLtDnmgNlVfcPYGhewObGtP8wIToQ1RM3K7JUzOPtkQDEWUlxcJ71bJFwewR8MKPLF1/hWKOLpyUX1yydldAupR/cas3kJIanA60OTyAgJbeuD8wVWTKSw9f6iIu3ui3s1tfwV6gRoEeJdFPKy1ltTxbeUwB5M9bLhBoJqQ/zncy7dy1FA6eFM0hb15Py2lIzchJ3/vFK/RUuYMnmBTgQZXBBnwf+fQ405kmZYOcuU/wE1nBuOt73g7RSdUe4qocs64tJyKBaW25DOMpLvdDTMxfJXt+jtXT0RyBcYoM5K4EP2tN98Kjq1Z3r9JGLbAwZzagdTX+IUx8eyiwJGssnAuOA7S/iyE+i1noMkVnPfuOthn9ZLf6cw1fyOA0PCt+fWtqWu9BF7yCJGVCg7dka0rQwrrw/oK782djJHOtiR3Jf3N7k9+Hyw3BWs7YMtXmNFWzUpLS1BrjMCIKoEPSskQFgom0eJ4TkLrfHi8DBrFUiGhhtrTe5BVqtvYSUT9GwkbAsEs9hjL3kJ400+3X/ceQUJiN9hAv9Zntql9+RkP9RbqopLQGW4=
