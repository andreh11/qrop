language: cpp

matrix:
  include:
    - os: linux
      env:
        - QROP_PLATFORM="linux"
        - PATH=""/usr/local/opt/qt/bin:$PATH"
        - LDFLAGS="-L/usr/local/opt/qt/lib"
        - CPPFLAGS="-I/usr/local/opt/qt/include"
        - PKG_CONFIG_PATH="/usr/local/opt/qt/lib/pkgconfig"
      compiler: g++
      dist: xenial
      sudo: required
      addons:
        apt:
          sources:
            - sourceline: 'ppa:beineri/opt-qt-5.12.0-xenial'
              key_url: 'https://keyserver.ubuntu.com/pks/lookup?op=get&search=0x10C56D0DE9977759'
          packages:
            - qt512-meta-full
            - qt512charts-no-lgpl
            - build-essential
            - libfontconfig1
            - mesa-common-dev
            - libglu1-mesa-dev
            - libsqlite3-dev
            - libxcb-xinerama0
    - os: osx
      env: QROP_PLATFORM="osx"
      osx_image: xcode7.2
      compiler: clang
      addons:
        homebrew:
          packages:
            - qt
            - tree
            - xz
            - hidapi
            - libusb
            - libxml2
            - libxslt
            - libzip
            - openssl
            - pkg-config
            - libgit2
            - libssh2
          update: true
    # - os: windows
    #   env: QROP_PLATFORM="linux"
    #   compiler: msvc2015

# before_install:
#   # - if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then sudo add-apt-repository ppa:beineri/opt-qt-5.12.0-xenial -y; fi
#   # - if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then sudo apt-get update     ; fi
#   - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then export PATH=/usr/local/opt/qt/bin:$PATH; fi
#   - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then export LDFLAGS="-L/usr/local/opt/qt/lib"; fi
#   - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then export CPPFLAGS="-I/usr/local/opt/qt/include"; fi
#   - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then export PKG_CONFIG_PATH="/usr/local/opt/qt/lib/pkgconfig"; fi

install:
  - if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then source /opt/qt512/bin/qt512-env.sh; fi

script:
  - source ${TRAVIS_BUILD_DIR}/dist/${QROP_PLATFORM}/build.sh

deploy:
  provider: releases
  api_key: $GH_TOKEN
  file: build/deploy/Qrop-x86_64.AppImage
  skip_cleanup: true
  draft: true

env:
  global:
    secure: a2sSFPhaFFjFPaJz9kWr1WCJGP1H4301Dhd8TzGR4ZxfqGpFjMn1k+92eVO3QKc9zVmSgHx95hIsSARMOs1yDaKthASSkkLBsrY9Uep6zGX9AXA8+N+pSMLtDnmgNlVfcPYGhewObGtP8wIToQ1RM3K7JUzOPtkQDEWUlxcJ71bJFwewR8MKPLF1/hWKOLpyUX1yydldAupR/cas3kJIanA60OTyAgJbeuD8wVWTKSw9f6iIu3ui3s1tfwV6gRoEeJdFPKy1ltTxbeUwB5M9bLhBoJqQ/zncy7dy1FA6eFM0hb15Py2lIzchJ3/vFK/RUuYMnmBTgQZXBBnwf+fQ405kmZYOcuU/wE1nBuOt73g7RSdUe4qocs64tJyKBaW25DOMpLvdDTMxfJXt+jtXT0RyBcYoM5K4EP2tN98Kjq1Z3r9JGLbAwZzagdTX+IUx8eyiwJGssnAuOA7S/iyE+i1noMkVnPfuOthn9ZLf6cw1fyOA0PCt+fWtqWu9BF7yCJGVCg7dka0rQwrrw/oK782djJHOtiR3Jf3N7k9+Hyw3BWs7YMtXmNFWzUpLS1BrjMCIKoEPSskQFgom0eJ4TkLrfHi8DBrFUiGhhtrTe5BVqtvYSUT9GwkbAsEs9hjL3kJ400+3X/ceQUJiN9hAv9Zntql9+RkP9RbqopLQGW4=
