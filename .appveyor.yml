# common settings
version: 0.1.{build}
clone_depth: 1
clone_folder: C:\projects\qrop
image: Visual Studio 2017

branches:
  only:
    - master

environment:
  matrix:
    - suffix: msvc2017_64
      arch: x64
    - suffix: msvc2015
      arch: x86

install:
  - cmd: '"C:\Program Files (x86)\Microsoft Visual Studio\2017\Community\VC\Auxiliary\Build\vcvarsall.bat" %arch%'
  - set QTDIR=C:\Qt\5.11\%suffix%
  - set PATH=%PATH%;%QTDIR%\bin;
  - cmd: mkdir C:\Code
  - cmd: cd C:\Code
  - ps: Start-FileDownload 'https://download.qt.io/official_releases/jom/jom_1_1_2.zip'
  - cmd: 7z x jom_1_1_2.zip -oC:/jom/
  - set PATH=%PATH%;C:/jom/;

build_script:
  - cmd: cd C:\projects\qrop
  - cmd: cmake . -G"NMake Makefiles JOM" -DCMAKE_BUILD_TYPE=Release
  - cmd: ls -al
  - cmd: jom -j4
  - cmd: cp core/release/*.dll release
  - cmd: windeployqt.exe --qmldir desktop\qml release

artifacts:
  - path: release\
    name: qrop-0.1-%arch%
    type: zip
