# common settings
version: 0.2-{build}
clone_depth: 1
clone_folder: C:\projects\qrop
image: Visual Studio 2017

branches:
  only:
    - master

environment:
  matrix:
    - suffix: msvc2017_64
      arch: x64
    - suffix: msvc2017
      arch: x86

install:
  - cmd: '"C:\Program Files (x86)\Microsoft Visual Studio\2017\Community\VC\Auxiliary\Build\vcvarsall.bat" %arch%'
  - set QTDIR=C:\Qt\5.12.2\%suffix%
  - set PATH=%PATH%;%QTDIR%\bin;
  - cmd: mkdir C:\Code
  - cmd: cd C:\Code
  - ps: Start-FileDownload 'https://download.qt.io/official_releases/jom/jom_1_1_3.zip'
  - cmd: 7z x jom_1_1_3.zip -oC:/jom/
  - set PATH=%PATH%;C:/jom/;

build_script:
  - cmd: cd C:\projects\qrop
  - cmd: cmake . -G"NMake Makefiles JOM" -DCMAKE_BUILD_TYPE=Release
  - cmd: jom -j4 
  - cmd: mkdir release
  - cmd: cp core/*.dll release/
  - cmd: cp qrop.exe release/
  - cmd: windeployqt.exe --release -sql --qmldir desktop\qml release 

artifacts:
  - path: release\
    name: Qrop-0.2-%arch%
    type: zip
